<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Category Tag Tool</title>
    <link rel="stylesheet" href="lib/bootstrap-4.0.0-alpha.2/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container">
    <table class="table table-bordered table-hover">
        <tr>
            <td>#</td>
            <td>PubMedID</td>
            <td>Title</td>
            <td>Tag</td>
        </tr>
        {% for article in articles %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><a target="_blank"
                       href="http://www.ncbi.nlm.nih.gov/pubmed/?term={{ article.pubMed_id }}">{{ article.pubMed_id }}</a>
                </td>
                <td>{{ article.title }}</td>
                <td>
                    <a class="btn btn-sm {% if article.pubMed_id in tagged_id_list %}btn-success {% else %}btn-primary{% endif %}"
                       data-toggle="modal" id="{{ article.pubMed_id }}"
                       data-target="#myModal" data-id="{{ article.pubMed_id }}">TAG</a></td>
            </tr>
        {% endfor %}
    </table>
</div>

<div class="modal fade modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        </div>
    </div>
</div>

</body>
<script type="application/javascript" src="lib/jquery/jquery-1.11.3.min.js"></script>
<script src="/lib/bootstrap-3.3.5/dist/js/bootstrap.min.js"></script>
<script type="application/javascript">
    $("#myModal").on({
                'show.bs.modal': function (evt) {
                    var _this = this;
                    $.ajax({
                        url: "/tag_one/" + $(evt.relatedTarget).data('id'),
                        method: 'get',
                        dataType: 'json',
                        success: function (response) {
                            $(_this).find('.modal-content').html(response.data).parent().fadeIn(300);
                        }
                    })
                },
                'shown.bs.modal': function (evt) {
                    var _this = this;
                    $(_this).find("#modal-form").on({
                        'submit': function (e) {
                            $.ajax({
                                url: "/tag",
                                method: "post",
                                dataType: 'json',
                                data: $("#modal-form").serialize(),
                                success: function (response) {
                                    var pubmed_id = response.data.id;
                                    //$("#" + pubmed_id).html(response.data.category);
                                    $("#" + pubmed_id).removeClass("btn-primary").addClass("btn-success");
                                    $("#myModal").modal('hide');
                                }
                            })
                            e.preventDefault();
                        }
                    })
                }
            }
    )
</script>
</html>